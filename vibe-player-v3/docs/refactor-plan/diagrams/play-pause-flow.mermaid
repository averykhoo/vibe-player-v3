%% vibe-player-v3/docs/refactor-plan/diagrams/play-pause-flow.mermaid
%% Detailed event flow for a play/pause command, showing the full unidirectional data loop.

sequenceDiagram
    actor User
    participant UI as Svelte Component
    participant Emitter as appEmitter
    participant Orchestrator as AudioOrchestratorService
    participant Engine as IAudioEnginePort
    participant Store as Svelte Stores

    User->>UI: Clicks 'Play' Button
    UI->>Emitter: emit('ui:playToggled')

    activate Emitter
    Emitter->>Orchestrator: (on 'ui:playToggled')
    deactivate Emitter

    activate Orchestrator
    Note right of Orchestrator: State Machine: READY -> PLAYING
    Orchestrator->>Store: playerStore.update({ status: 'playing' })
    Orchestrator->>Engine: play()
    deactivate Orchestrator

    Store->>UI: 1. `playerStore.status` is now 'playing'.
    Store->>UI: 2. Derived store `isPlaying` becomes `true`.
    Note over UI: Reacts to `isPlaying` store change,<br/>changing button icon to 'Pause'.